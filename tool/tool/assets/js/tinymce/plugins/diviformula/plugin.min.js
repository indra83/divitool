tinymce.PluginManager.add('diviformula', function(editor, url) {
    // Add a button that opens a window
    editor.addButton('diviformula', {
        text: ' Divi Formula ',
        icon: false,
        onclick: function() {
            // Open window
            // var scriptLoader = new tinymce.dom.ScriptLoader();
            // scriptLoader.load('MathJax/MathJax.js?config=TeX-AMS-MML_HTMLorMML');

            editor.focus();
            editor.windowManager.open({

                title: 'diviformula plugin',
                body: [
                    {type: 'filepicker', name: 'title', label: 'Title'}

                ],
                onsubmit: function(e) {
                    // Insert content when the window form is submitted
                    editor.insertContent('\\['+e.data.title+'\\]');
                    MathJax.Hub.Queue(['Typeset',MathJax.Hub,editor.dom.getRoot()]);
                    editor.insertContent('Formula here');
                }
            });
        }
    });

    editor.addMenuItem('diviformula', {
        text: 'diviformula plugin',
        context: 'tools',
        onclick: function() {
            // Open window with a specific url
            // var scriptLoader = new tinymce.dom.ScriptLoader();
            // scriptLoader.load('MathJax/MathJax.js?config=TeX-AMS-MML_HTMLorMML');
            $ = editor.getWin().parent.jQuery;
            MathJax.Hub.Config({
              tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
            });
            console.log('done');
            editor.windowManager.open({
                // editor.focus();
                title: 'diviformula plugin',
                // body: [
                //     {type: 'FilePicker', name: 'title', label: 'Title'}
                // ],
                url:'test.html',
                onsubmit: function(e) {
                    // Insert content when the window form is submitted
                    editor.insertContent('\\['+e.data.title+'\\]');
                    MathJax.Hub.Queue(['Typeset',MathJax.Hub,editor.dom.getRoot()]);
                }
            });
        }
    });

});