(function(){tinymce.create("tinymce.plugins.FormulaUploadPlugin",{init:function(e,t){t=tinyMCE.activeEditor.getParam("formulaupload_rel")||t;var n=tinyMCE.activeEditor.getParam("formulaupload_url");var r=document.getElementsByTagName("body")[0];var i=document.createElement("link");i.type="text/css";i.rel="stylesheet";i.href=t+"/css/style.css";r.appendChild(i);e.addCommand("mceImageUpload",function(){$("#image_upload_type").val("tinymce");$("body").append('<div class="formulaUploadBg"></div>');var t=function(e){$(".formulaUploadError").html(e).show();r()};var r=function(){$(".formulaUploadFg").remove();$(".formulaUploadFgLoading").remove()};var i=function(){$(".formulaUploadBg").remove();$(".formulaUploadContainer").remove()};var s='                    <div class="formulaUploadContainer mce-container mce-panel mce-window">                        <div class="formulaUploadContainerInner">                            <div class="mce-window-head">                                <div class="mce-title">Upload Image</div>                                <button type="button" class="mce-close">Ã—</button>                            </div>                            <form action="'+n+'" method="POST"  enctype="multipart/form-data" id="uploadImageForm">                            <div class="mce-container formulaUploadFormContainer" hidefocus="1" tabindex="-1">                                <div class="mce-container-body">                                    <label for="image-upload-area">Select a file</label>                                    <input type="file" name="file" id="image-upload-area" class="mce-textbox mce-placeholder" hidefocus="true" style="width: 258px;">                                </div>                                <p class="formulaUploadError"></p>                            </div>                            </form>                            <div class="formulaUploadConfirmCase mce-panel">                                <div class="mce-btn mce-primary">                                    <button role="presentation" class="formulaUploadSubmit">Upload</button>                                </div>                                <div class="mce-btn">                                    <button role="presentation" class="formulaUploadClose">Close</button>                                </div>                            </div>                        </div>                    </div>                ';$("body").append(s);$(".formulaUploadBg, .formulaUploadContainer .formulaUploadClose, .mce-close").on("click",function(){r();i()});$("#uploadImageForm").iframePostForm({json:true,post:function(){},complete:function(n){if(typeof n!="object"||n==null||typeof n.error=="undefined"){r();t("An error occurred while uploading your image.")}else{if(n.error!=false){switch(n.error){case"filetype":t("Please select a valid image and try again.");break;default:t("An unknown error occurred.");break}}else{if(typeof n.path!="undefined"){var s='<img src="%s" />';e.insertContent(s.replace("%s",n.path));e.focus();r();i()}else{t("An unknown error occurred.")}}}}});$(".formulaUploadSubmit").on("click",function(){$(".formulaUploadError").html("").hide();if($("#image-upload-area").val()!=""){$("body").append('<div class="formulaUploadFg"></div>');$("body").append('<div class="formulaUploadFgLoading"></div>');$("#uploadImageForm").submit()}else{t("Please select an image to upload.")}})});e.addButton("formulaupload",{title:"Image Upload",cmd:"mceImageUpload",image:t+"/img/icon.png"})},getInfo:function(){return{longname:"Image Upload",author:"BoxUK",authorurl:"https://github.com/boxuk/tinymce-formulaupload",infourl:"https://github.com/boxuk/tinymce-formulaupload/blob/master/README.md",version:"1.0.0"}}});tinymce.PluginManager.add("formulaupload",tinymce.plugins.FormulaUploadPlugin)})()